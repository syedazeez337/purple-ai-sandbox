name: "p0-test-policy"
description: "Test policy to verify P0 critical fixes: seccomp deny list and IPv6 blocking"

filesystem:
  immutable_paths:
    - host_path: "/usr/bin"
      sandbox_path: "/usr/bin"
    - host_path: "/bin"
      sandbox_path: "/bin"
    - host_path: "/lib"
      sandbox_path: "/lib"
    - host_path: "/lib64"
      sandbox_path: "/lib64"
  scratch_paths:
    - "/tmp"
  output_paths: []
  working_dir: "/tmp"

# TEST 1: Seccomp deny list with default_deny=false
# This tests the new deny list implementation
syscalls:
  default_deny: false  # Allow all syscalls by default
  allow: []            # No explicit allow needed in this mode
  deny:                # These syscalls should be explicitly blocked
    - "mount"          # Block mounting filesystems
    - "umount2"        # Block unmounting
    - "reboot"         # Block system reboot
    - "kexec_load"     # Block loading new kernel
    - "init_module"    # Block loading kernel modules
    - "delete_module"  # Block unloading kernel modules
    - "ptrace"         # Block process tracing

resources:
  cpu_shares: 1.0
  memory_limit_bytes: "1G"
  pids_limit: 50
  session_timeout_seconds: 60

capabilities:
  default_drop: true
  add: []

# TEST 2: IPv6 blocking
# This tests the new IPv6 support in eBPF network filter
network:
  isolated: false
  allow_outgoing:
    - "443"
    - "80"
    - "53"
  allow_incoming: []
  blocked_ips:
    # IPv4 test addresses
    - "192.168.100.100"
    - "10.0.0.1"
    # IPv6 test addresses (new feature!)
    - "2001:db8::1"
    - "fe80::1"
    - "::1"

audit:
  enabled: true
  log_path: "/tmp/purple/audit/p0-test.log"
  detail_level:
    - "syscall"
    - "network"

ebpf_monitoring:
  enabled: true
  trace_syscalls: true
  trace_files: false
  trace_network: true
  correlation_enabled: false
