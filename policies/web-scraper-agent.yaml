# Policy 3: Web Scraper Agent
# Use Case: Automated web scraping, data collection from websites
# Security Level: Low - needs network but limited local access

name: "web-scraper-agent"
description: "Sandbox for web scraping agents. Allows network access to specific domains with limited local filesystem access."

filesystem:
  immutable_paths:
    - host_path: "/usr"
      sandbox_path: "/usr"
    - host_path: "/lib"
      sandbox_path: "/lib"
    - host_path: "/lib64"
      sandbox_path: "/lib64"
    - host_path: "/etc/ssl"
      sandbox_path: "/etc/ssl"
  scratch_paths:
    - "/tmp"
  output_paths:
    - host_path: "/tmp/purple/output/scraped-data"
      sandbox_path: "/output"
  working_dir: "/tmp"

syscalls:
  default_deny: true
  allow:
    # File operations (supported by compiler)
    - "read"
    - "write"
    - "openat"
    - "close"
    - "fstat"
    - "newfstatat"
    - "lseek"
    # Memory
    - "mmap"
    - "mprotect"
    - "munmap"
    - "brk"
    # Process
    - "execve"
    - "exit_group"
    - "clone3"
    # System info
    - "getuid"
    - "getgid"
    - "geteuid"
    - "getegid"
    # Required
    - "arch_prctl"
    - "rseq"
    - "set_tid_address"
    - "set_robust_list"
    - "prlimit64"
    - "getrandom"
    - "poll"
    - "pipe"
    - "fcntl"
    - "ioctl"
    - "rt_sigaction"
    - "rt_sigprocmask"
    - "rt_sigreturn"
    - "access"
    - "stat"
    - "lstat"
    - "prctl"
    - "capget"
    - "capset"
    - "getcwd"
    - "pread64"
    - "writev"
    - "getpid"
    - "getppid"
    - "gettid"
    - "getgroups"
    - "uname"
    - "futex"
    - "clock_gettime"
    - "readlinkat"
    - "socket"
    - "connect"
    - "sendto"
    - "recvfrom"
    - "sendmsg"
    - "recvmsg"
    - "bind"
    - "listen"
    - "accept"
    - "setsockopt"
    - "getsockopt"
    - "getsockname"
    - "getpeername"
  deny:
    - "mount"
    - "unmount"
    - "reboot"
    - "kexec_load"
    - "bpf"
    - "unlinkat"
    - "renameat2"

resources:
  cpu_shares: 0.3
  memory_limit_bytes: "2G"
  pids_limit: 50
  block_io_limit: "20MBps"
  session_timeout_seconds: 7200

capabilities:
  default_drop: true
  add: []

network:
  isolated: false
  allow_outgoing:
    - "443"
    - "80"
    - "53"
  allow_incoming: []

audit:
  enabled: true
  log_path: "/var/log/purple/web-scraper.log"
  detail_level:
    - "syscall"
    - "filesystem"
